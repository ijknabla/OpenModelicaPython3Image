FROM ubuntu:22.04 AS openmodelica{stage.om!s}-python{stage.py!s}

COPY --from=openmodelica{stage.om!s} /artifact/usr/ /usr/
COPY --from=python{stage.py!s}       /artifact/usr/ /usr/
ENV DEBIAN_FRONTEND=noninteractive
RUN \
    apt update \
    && apt install -y \
    make clang libgfortran-12-dev libcurl4 libblas-dev liblapack-dev \
    libssl3 zlib1g \
    libbz2-1.0 libreadline8 libsqlite3-0 git \
    libncursesw6 tk libxml2 libxmlsec1 libffi8 liblzma5 \
    && update-alternatives --install /usr/bin/2to3   2to3   /usr/bin/2to3-{stage.py.short!s}  10 \
    && update-alternatives --install /usr/bin/idle   idle   /usr/bin/idle{stage.py.short!s}   10 \
    && update-alternatives --install /usr/bin/pip    pip    /usr/bin/pip{stage.py.short!s}    10 \
    && update-alternatives --install /usr/bin/pydoc  pydoc  /usr/bin/pydoc{stage.py.short!s}  10 \
    && update-alternatives --install /usr/bin/python python /usr/bin/python{stage.py.short!s} 10
